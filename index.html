<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indice Articoli - Autoaggiornante</title>
    <style>
        /* Stili minimali per la lista */
        body { font-family: sans-serif; padding: 20px; }
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        a { text-decoration: none; color: #1a73e8; font-weight: bold; }
        span.date { color: #5f6368; font-size: 0.85em; margin-left: 10px; }
        .loading-message { font-style: italic; color: gray; }
    </style>
</head>
<body>

    <h1>Indice Completo degli Articoli</h1>
    <div id="sitemap-index" class="loading-message">
        Caricamento indice in corso...
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ** Modifica qui l'URL del tuo sitemap **
            // MODIFICA: Aggiunto l'URL del proxy per risolvere il problema CORS
            const sitemapUrl = 'https://corsproxy.io/?' + encodeURIComponent('https://loroscopodicagliostro.blogspot.com/sitemap.xml');
            const container = document.getElementById('sitemap-index');

            fetch(sitemapUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Errore HTTP: ${response.status}`);
                    }
                    return response.text();
                })
                .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
                .then(data => {
                    const urls = data.getElementsByTagName('url');
                    let items = [];

                    for (let url of urls) {
                        const locElement = url.getElementsByTagName('loc')[0];
                        const lastModElement = url.getElementsByTagName('lastmod')[0];
                        
                        // Assicurati che esista almeno l'URL
                        if (!locElement) continue;

                        const loc = locElement.textContent;
                        const lastMod = lastModElement ? new Date(lastModElement.textContent) : null;

                        // Estrazione del titolo dallo slug URL (parte finale)
                        let urlParts = loc.split('/');
                        let slug = urlParts[urlParts.length - 1].replace('.html', '');
                        
                        // Trasforma lo slug (es. "dal-micro-al-macro") in un titolo leggibile
                        let title = slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                        items.push({ loc, title, lastMod });
                    }

                    // Ordina gli articoli per data di pubblicazione (dal più recente al più vecchio)
                    items.sort((a, b) => b.lastMod - a.lastMod);

                    // Genera l'HTML
                    let html = '<ul>';
                    items.forEach(item => {
                        const dateStr = item.lastMod ? item.lastMod.toLocaleDateString('it-IT') : '';
                        html += `<li><a href="${item.loc}">${item.title}</a> <span class="date">(${dateStr})</span></li>`;
                    });
                    html += '</ul>';

                    container.classList.remove('loading-message');
                    container.innerHTML = html;
                })
                .catch(error => {
                    container.innerHTML = '⚠️ Impossibile caricare il sitemap. Verifica l\'URL o le impostazioni di CORS.';
                    console.error('Errore durante il fetch del sitemap:', error);
                });
        });
    </script>
</body>
</html>
